<script>
/* ---------- CONFIG ---------- */
const telegramLink = "https://t.me/+8_sPcNT8ZHFlZGVl"; // NEW UPDATED LINK

/* ---------- STATE ---------- */
let answered = false;
const qBox = document.getElementById('q-box'), bar = document.getElementById('bar'), progNum = document.getElementById('progNum');

/* ---------- RENDER ---------- */
function renderSingleQuestion(){
  qBox.innerHTML = `
    <div class="question">
      <div class="hype pulse">ðŸ”¥ Live Forex set-ups â€” join our learning community</div>
      <div style="height:8px"></div>
      <div class="options">
        <div class="option" data-val="yes">Yes â€” I want access to signals & learning</div>
        <div class="option" data-val="no">Not right now â€” show me resources</div>
      </div>
      <div class="small">Takes one tap. We share educational trade ideas only â€” not financial advice.</div>
    </div>
  `;
  updateProgress(0);
  document.querySelectorAll('.option').forEach(o=>o.addEventListener('click', onChooseSingle));
}

function updateProgress(pct){
  bar.style.width = pct + "%";
  progNum.textContent = pct + "%";
}

/* ---------- PIXEL TRACKING WRAPPER ---------- */
function track(eventName, payload){
  try{ fbq('track', eventName, payload || {});}catch(e){}
}

/* ---------- QUESTION LOGIC ---------- */
function onChooseSingle(ev){
  if(answered) return;
  answered = true;
  const el = ev.currentTarget;
  const val = el.getAttribute('data-val');
  document.querySelectorAll('.option').forEach(o=>o.classList.remove('selected'));
  el.classList.add('selected');

  track('OptionClick', {choice: val}); /* <-- ðŸ“Œ Pixel here */

  setTimeout(()=>{ updateProgress(66); showConfirmFor(val); },220);
}

function showConfirmFor(val){
  if(val === 'yes'){
    qBox.innerHTML = `
      <div class="thankyou">
        <div class="hype small">You're almost there â€” quick confirm</div>
        <div class="thank-sub">We keep the group focused on learning and real setups. Educational content only.</div>
        <div><span class="fomo">âš¡ Limited interactive spots â€” priority given to active learners</span></div>
        <div class="row" style="margin-top:14px">
          <button id="proceedBtn" class="join-btn">Proceed to Telegram â†’</button>
        </div>
        <div class="note">By proceeding you confirm you want educational trade setups. Not financial advice.</div>
      </div>
    `;
    updateProgress(85);

    track('SubscribeIntent', {interested:'yes'}); /* <-- ðŸ“Œ Pixel */

    setTimeout(()=>{ const pb = document.getElementById('proceedBtn'); if(pb) pb.addEventListener('click', onProceedClickYes); },80);
  } else {
    qBox.innerHTML = `
      <div class="thankyou">
        <div class="hype small">No problem â€” check our free resources</div>
        <div class="thank-sub">We share guides, sample setups and educational posts in the resource page.</div>
        <div class="row">
          <button id="backBtn" class="btn-ghost">Back</button>
          <a id="learnBtn" class="join-btn" href="${telegramLink}" target="_blank" rel="noopener">See Resources â†’</a>
        </div>
        <div class="note">You can always come back and request signals later.</div>
      </div>
    `;
    updateProgress(100);

    track('SubscribeIntent', {interested:'no'}); /* <-- ðŸ“Œ Pixel */

    setTimeout(()=>{ const bb=document.getElementById('backBtn'); if(bb) bb.addEventListener('click', ()=>{ answered=false; renderSingleQuestion(); }); },50);
    setTimeout(()=>{ const lb=document.getElementById('learnBtn'); if(lb) lb.addEventListener('click', ()=>track('ResourceClick',{interested:'no'})); },50);
  }
}

/* ---------- REDIRECT + PIXEL ---------- */
function onProceedClickYes(){
  track('ProceedClick', {interested:'yes'}); /* <-- ðŸ“Œ Pixel */

  const redirectUrl = window.location.origin + '/redirect.html?to=telegram';
  const win = window.open(redirectUrl, '_blank', 'noopener');
  if(!win){ window.location.href = redirectUrl; }

  qBox.innerHTML = `
    <div class="thankyou">
      <div class="hype small">Done â€” check your Telegram</div>
      <div class="thank-sub">If Telegram didn't open, tap the button again.</div>
      <div class="row" style="margin-top:12px">
        <a class="join-btn" href="/redirect.html?to=telegram" target="_blank" rel="noopener">Open Telegram â†’</a>
      </div>
      <div class="note">Educational content only. No guarantees of profit.</div>
    </div>
  `;
  updateProgress(100);
}

/* ---------- INITIAL ---------- */
renderSingleQuestion();
</script>
